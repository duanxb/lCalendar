window.lCalendar=function(){var e=function(){this.gearDate,this.minY=1900,this.minM=1,this.minD=1,this.maxY=2099,this.maxM=12,this.maxD=31};return e.prototype={init:function(e){if(this.type=e.type,this.lcalendar=e.lcalendar,this.dayDisabled=e.dayDisabled||[],this.weekendDisabled=e.weekendDisabled||!1,this.onConfirm=e.onConfirm||function(){},this.onCancel=e.onCancel||function(){},this.trigger=document.querySelector(e.trigger),null!=this.trigger.getAttribute("data-lcalendar")){var t=this.trigger.getAttribute("data-lcalendar").split(","),a=t[0].split("-");this.minY=~~a[0],this.minM=~~a[1],this.minD=~~a[2];var r=t[1].split("-");this.maxY=~~r[0],this.maxM=~~r[1],this.maxD=~~r[2]}if(this.lcalendar){var d=this.lcalendar.split(",");e.minDate=d[0],e.maxDate=d[1]}if(e.minDate){var a=e.minDate.split("-");this.minY=~~a[0],this.minM=~~a[1],this.minD=~~a[2]}if(e.maxDate){var r=e.maxDate.split("-");this.maxY=~~r[0],this.maxM=~~r[1],this.maxD=~~r[2]}this.bindEvent(this.type)},bindEvent:function(e){function t(e){L.gearDate=document.createElement("div"),L.gearDate.className="gearDate",L.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="current_date_error"></div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div></div></div></div>',document.body.appendChild(L.gearDate),a();var t=L.gearDate.querySelector(".lcalendar_cancel");t.addEventListener("touchstart",b);var r=L.gearDate.querySelector(".lcalendar_finish");r.addEventListener("touchstart",D);var d=L.gearDate.querySelector(".date_yy"),i=L.gearDate.querySelector(".date_mm"),n=L.gearDate.querySelector(".date_dd");d.addEventListener("touchstart",m),i.addEventListener("touchstart",m),n.addEventListener("touchstart",m),d.addEventListener("touchmove",g),i.addEventListener("touchmove",g),n.addEventListener("touchmove",g),d.addEventListener("touchend",y),i.addEventListener("touchend",y),n.addEventListener("touchend",y),document.querySelector("body").style.overflow="hidden"}function a(){var e=new Date,t={yy:e.getFullYear(),mm:e.getMonth(),dd:e.getDate()-1};/^\d{4}-\d{1,2}-\d{1,2}$/.test(L.trigger.value)?(rs=L.trigger.value.match(/(^|-)\d{1,4}/g),t.yy=rs[0]-L.minY,t.mm=rs[1].replace(/-/g,"")-1,t.dd=rs[2].replace(/-/g,"")-1):t.yy=t.yy-L.minY,L.gearDate.querySelector(".date_yy").setAttribute("val",t.yy),L.gearDate.querySelector(".date_mm").setAttribute("val",t.mm),L.gearDate.querySelector(".date_dd").setAttribute("val",t.dd),o()}function r(e){L.gearDate=document.createElement("div"),L.gearDate.className="gearDate",L.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="ym_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div></div></div></div>',document.body.appendChild(L.gearDate),d();var t=L.gearDate.querySelector(".lcalendar_cancel");t.addEventListener("touchstart",b);var a=L.gearDate.querySelector(".lcalendar_finish");a.addEventListener("touchstart",p);var r=L.gearDate.querySelector(".date_yy"),i=L.gearDate.querySelector(".date_mm");r.addEventListener("touchstart",m),i.addEventListener("touchstart",m),r.addEventListener("touchmove",g),i.addEventListener("touchmove",g),r.addEventListener("touchend",y),i.addEventListener("touchend",y),document.querySelector("body").style.overflow="hidden"}function d(){var e=new Date,t={yy:e.getFullYear(),mm:e.getMonth()};/^\d{4}-\d{1,2}$/.test(L.trigger.value)?(rs=L.trigger.value.match(/(^|-)\d{1,4}/g),t.yy=rs[0]-L.minY,t.mm=rs[1].replace(/-/g,"")-1):t.yy=t.yy-L.minY,L.gearDate.querySelector(".date_yy").setAttribute("val",t.yy),L.gearDate.querySelector(".date_mm").setAttribute("val",t.mm),o()}function n(e){L.gearDate=document.createElement("div"),L.gearDate.className="gearDatetime",L.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(L.gearDate),s();var t=L.gearDate.querySelector(".lcalendar_cancel");t.addEventListener("touchstart",b);var a=L.gearDate.querySelector(".lcalendar_finish");a.addEventListener("touchstart",f);var r=L.gearDate.querySelector(".date_yy"),d=L.gearDate.querySelector(".date_mm"),i=L.gearDate.querySelector(".date_dd"),n=L.gearDate.querySelector(".time_hh"),l=L.gearDate.querySelector(".time_mm");r.addEventListener("touchstart",m),d.addEventListener("touchstart",m),i.addEventListener("touchstart",m),n.addEventListener("touchstart",m),l.addEventListener("touchstart",m),r.addEventListener("touchmove",g),d.addEventListener("touchmove",g),i.addEventListener("touchmove",g),n.addEventListener("touchmove",g),l.addEventListener("touchmove",g),r.addEventListener("touchend",y),d.addEventListener("touchend",y),i.addEventListener("touchend",y),n.addEventListener("touchend",y),l.addEventListener("touchend",y),document.querySelector("body").style.overflow="hidden"}function s(){var e=new Date,t={yy:e.getFullYear(),mm:e.getMonth(),dd:e.getDate()-1,hh:e.getHours(),mi:e.getMinutes()};/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(L.trigger.value)?(rs=L.trigger.value.match(/(^|-|\s|:)\d{1,4}/g),t.yy=rs[0]-L.minY,t.mm=rs[1].replace(/-/g,"")-1,t.dd=rs[2].replace(/-/g,"")-1,t.hh=parseInt(rs[3].replace(/\s0?/g,"")),t.mi=parseInt(rs[4].replace(/:0?/g,""))):t.yy=t.yy-L.minY,L.gearDate.querySelector(".date_yy").setAttribute("val",t.yy),L.gearDate.querySelector(".date_mm").setAttribute("val",t.mm),L.gearDate.querySelector(".date_dd").setAttribute("val",t.dd),o(),L.gearDate.querySelector(".time_hh").setAttribute("val",t.hh),L.gearDate.querySelector(".time_mm").setAttribute("val",t.mi),c()}function l(e){L.gearDate=document.createElement("div"),L.gearDate.className="gearDate",L.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(L.gearDate),v();var t=L.gearDate.querySelector(".lcalendar_cancel");t.addEventListener("touchstart",b);var a=L.gearDate.querySelector(".lcalendar_finish");a.addEventListener("touchstart",q);var r=L.gearDate.querySelector(".time_hh"),d=L.gearDate.querySelector(".time_mm");r.addEventListener("touchstart",m),d.addEventListener("touchstart",m),r.addEventListener("touchmove",g),d.addEventListener("touchmove",g),r.addEventListener("touchend",y),d.addEventListener("touchend",y),document.querySelector("body").style.overflow="hidden"}function v(){var e=new Date,t={hh:e.getHours(),mm:e.getMinutes()};/^\d{2}:\d{2}$/.test(L.trigger.value)&&(rs=L.trigger.value.match(/(^|:)\d{2}/g),t.hh=parseInt(rs[0].replace(/^0?/g,"")),t.mm=parseInt(rs[1].replace(/:0?/g,""))),L.gearDate.querySelector(".time_hh").setAttribute("val",t.hh),L.gearDate.querySelector(".time_mm").setAttribute("val",t.mm),c()}function o(){var e=L.maxY-L.minY+1,t=L.gearDate.querySelector(".date_yy"),a="";if(t&&t.getAttribute("val")){for(var r=parseInt(t.getAttribute("val")),d=0;d<=e-1;d++)a+="<div class='tooth'>"+(L.minY+d)+"</div>";t.innerHTML=a;var i=Math.floor(parseFloat(t.getAttribute("top")));if(isNaN(i))t.style["-webkit-transform"]="translate3d(0,"+(8-2*r)+"em,0)",t.setAttribute("top",8-2*r+"em");else{i%2==0?i=i:i+=1,i>8&&(i=8);var n=8-2*(e-1);i<n&&(i=n),t.style["-webkit-transform"]="translate3d(0,"+i+"em,0)",t.setAttribute("top",i+"em"),r=Math.abs(i-8)/2,t.setAttribute("val",r)}var s=L.gearDate.querySelector(".date_mm");if(s&&s.getAttribute("val")){a="";var l=parseInt(s.getAttribute("val")),v=11,o=0;r==e-1&&(v=L.maxM-1),0==r&&(o=L.minM-1);for(var d=0;d<v-o+1;d++)a+="<div class='tooth'>"+(o+d+1)+"</div>";s.innerHTML=a,l>v?(l=v,s.setAttribute("val",l)):l<o&&(l=v,s.setAttribute("val",l)),s.style["-webkit-transform"]="translate3d(0,"+(8-2*(l-o))+"em,0)",s.setAttribute("top",8-2*(l-o)+"em");var c=L.gearDate.querySelector(".date_dd");if(c&&c.getAttribute("val")){a="";var m=parseInt(c.getAttribute("val")),g=u(r,l),y=g-1,h=0;r==e-1&&L.maxM==l+1&&(y=L.maxD-1),0==r&&L.minM==l+1&&(h=L.minD-1);for(var d=0;d<y-h+1;d++)a+="<div class='tooth'>"+(h+d+1)+"</div>";c.innerHTML=a,m>y?(m=y,c.setAttribute("val",m)):m<h&&(m=h,c.setAttribute("val",m)),c.style["-webkit-transform"]="translate3d(0,"+(8-2*(m-h))+"em,0)",c.setAttribute("top",8-2*(m-h)+"em")}}}}function c(){var e=L.gearDate.querySelector(".time_hh");if(e&&e.getAttribute("val")){for(var t="",a=parseInt(e.getAttribute("val")),r=0;r<=23;r++)t+="<div class='tooth'>"+r+"</div>";e.innerHTML=t,e.style["-webkit-transform"]="translate3d(0,"+(8-2*a)+"em,0)",e.setAttribute("top",8-2*a+"em");var d=L.gearDate.querySelector(".time_mm");if(d&&d.getAttribute("val")){for(var t="",i=parseInt(d.getAttribute("val")),r=0;r<=59;r++)t+="<div class='tooth'>"+r+"</div>";d.innerHTML=t,d.style["-webkit-transform"]="translate3d(0,"+(8-2*i)+"em,0)",d.setAttribute("top",8-2*i+"em")}}}function u(e,t){return 1==t?(e+=L.minY,e%4==0&&e%100!=0||e%400==0&&e%4e3!=0?29:28):3==t||5==t||8==t||10==t?30:31}function m(e){e.preventDefault();for(var t=e.target;;){if(t.classList.contains("gear"))break;t=t.parentElement}clearInterval(t["int_"+t.id]),t["old_"+t.id]=e.targetTouches[0].screenY,t["o_t_"+t.id]=(new Date).getTime();var a=t.getAttribute("top");a?t["o_d_"+t.id]=parseFloat(a.replace(/em/g,"")):t["o_d_"+t.id]=0,t.style.webkitTransitionDuration=t.style.transitionDuration="0ms",E("")}function g(e){e.preventDefault();for(var t=e.target;;){if(t.classList.contains("gear"))break;t=t.parentElement}t["new_"+t.id]=e.targetTouches[0].screenY,t["n_t_"+t.id]=(new Date).getTime();var a=30*(t["new_"+t.id]-t["old_"+t.id])/window.innerHeight;t["pos_"+t.id]=t["o_d_"+t.id]+a,t.style["-webkit-transform"]="translate3d(0,"+t["pos_"+t.id]+"em,0)",t.setAttribute("top",t["pos_"+t.id]+"em"),e.targetTouches[0].screenY<1&&y(e)}function y(e){e.preventDefault();for(var t=e.target;;){if(t.classList.contains("gear"))break;t=t.parentElement}var a=(t["new_"+t.id]-t["old_"+t.id])/(t["n_t_"+t.id]-t["o_t_"+t.id]);a&&(Math.abs(a)<=.2?t["spd_"+t.id]=a<0?-.08:.08:Math.abs(a)<=.5?t["spd_"+t.id]=a<0?-.16:.16:t["spd_"+t.id]=a/2,t["pos_"+t.id]||(t["pos_"+t.id]=0)),h(t)}function h(e){function t(){e.style.webkitTransitionDuration=e.style.transitionDuration="200ms",r=!0}var a=0,r=!1,d=L.maxY-L.minY+1;clearInterval(e["int_"+e.id]),e["int_"+e.id]=setInterval(function(){var i=e["pos_"+e.id],n=e["spd_"+e.id]*Math.exp(-.03*a);if(i+=n,i&&n){if(Math.abs(n)>.1);else{var s=2*Math.round(i/2);i=s,t()}switch(i>8&&(i=8,t()),e.dataset.datetype){case"date_yy":var l=8-2*(d-1);if(i<l&&(i=l,t()),r){var v=Math.abs(i-8)/2;_(e,v),clearInterval(e["int_"+e.id])}break;case"date_mm":var o=L.gearDate.querySelector(".date_yy"),c=parseInt(o.getAttribute("val")),m=11,g=0;c==d-1&&(m=L.maxM-1),0==c&&(g=L.minM-1);var l=8-2*(m-g);if(i<l&&(i=l,t()),r){var v=Math.abs(i-8)/2+g;_(e,v),clearInterval(e["int_"+e.id])}break;case"date_dd":var o=L.gearDate.querySelector(".date_yy"),y=L.gearDate.querySelector(".date_mm"),c=parseInt(o.getAttribute("val")),h=parseInt(y.getAttribute("val")),b=u(c,h),D=b-1,p=0;c==d-1&&L.maxM==h+1&&(D=L.maxD-1),0==c&&L.minM==h+1&&(p=L.minD-1);var l=8-2*(D-p);if(i<l&&(i=l,t()),r){var v=Math.abs(i-8)/2+p;_(e,v),clearInterval(e["int_"+e.id])}break;case"time_hh":if(i<-38&&(i=-38,t()),r){var v=Math.abs(i-8)/2;_(e,v),clearInterval(e["int_"+e.id])}break;case"time_mm":if(i<-110&&(i=-110,t()),r){var v=Math.abs(i-8)/2;_(e,v),clearInterval(e["int_"+e.id])}}e["pos_"+e.id]=i,e.style["-webkit-transform"]="translate3d(0,"+i+"em,0)",e.setAttribute("top",i+"em"),a++}},30)}function _(e,t){t=Math.round(t),e.setAttribute("val",t),/date/.test(e.dataset.datetype)?o():c()}function b(e){e.preventDefault();var t;try{t=new CustomEvent("input")}catch(e){t=document.createEvent("Event"),t.initEvent("input",!0,!0)}L.trigger.dispatchEvent(t),document.body.removeChild(L.gearDate),L.gearDate=null,L.onCancel(),document.querySelector("body").style.overflow=""}function D(e){var t=L.maxY-L.minY+1,a=parseInt(Math.round(L.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(L.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=r>9?r:"0"+r;var d=parseInt(Math.round(L.gearDate.querySelector(".date_dd").getAttribute("val")))+1;d=d>9?d:"0"+d;var i=a%t+L.minY+"-"+r+"-"+d;return S(i)!==!1&&(L.trigger.value=i,b(e),L.onConfirm(L.trigger.value),void(document.querySelector("body").style.overflow=""))}function p(e){var t=L.maxY-L.minY+1,a=parseInt(Math.round(L.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(L.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=r>9?r:"0"+r,L.trigger.value=a%t+L.minY+"-"+r,b(e),L.onConfirm(L.trigger.value),document.querySelector("body").style.overflow=""}function f(e){var t=L.maxY-L.minY+1,a=parseInt(Math.round(L.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(L.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=r>9?r:"0"+r;var d=parseInt(Math.round(L.gearDate.querySelector(".date_dd").getAttribute("val")))+1;d=d>9?d:"0"+d;var i=parseInt(Math.round(L.gearDate.querySelector(".time_hh").getAttribute("val")));i=i>9?i:"0"+i;var n=parseInt(Math.round(L.gearDate.querySelector(".time_mm").getAttribute("val")));n=n>9?n:"0"+n;var s=a%t+L.minY+"-"+r+"-"+d;return S(s)!==!1&&(L.trigger.value=a%t+L.minY+"-"+r+"-"+d+" "+(i.length<2?"0":"")+i+(n.length<2?":0":":")+n,b(e),L.onConfirm(L.trigger.value),void(document.querySelector("body").style.overflow=""))}function q(e){var t=parseInt(Math.round(L.gearDate.querySelector(".time_hh").getAttribute("val")));t=t>9?t:"0"+t;var a=parseInt(Math.round(L.gearDate.querySelector(".time_mm").getAttribute("val")));a=a>9?a:"0"+a,L.trigger.value=(t.length<2?"0":"")+t+(a.length<2?":0":":")+a,b(e),L.onConfirm(L.trigger.value),document.querySelector("body").style.overflow=""}function S(e){if(L.weekendDisabled){var t=new Date(e).getDay();if(6==t||0==t)return E(e+" 节假日不可选择"),!1}return!(L.dayDisabled.length>0&&L.dayDisabled.contains(e)===!0)||(E(e+"节假日不可选择"),!1)}function E(e){var t=document.querySelector(".current_date_error");t.innerHTML=e}var L=this;Array.prototype.contains=function(e){for(i in this)if(this[i]==e)return!0;return!1},L.trigger.addEventListener("click",{ym:r,date:t,datetime:n,time:l}[e])}},e}();